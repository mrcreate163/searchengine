# Объяснение исправления проблемы с базой данных

## Проблема

При попытке развернуть проект в продакшене, приложение падало с ошибкой:

```
Schema-validation: missing table [`index`]
```

## Причина

В конфигурационном файле `src/main/resources/application-prod.yaml` параметр Hibernate был установлен на `ddl-auto: validate`. Это означает, что Hibernate только проверяет соответствие схемы базы данных и классов-сущностей, но **не создает** таблицы автоматически.

При первом запуске приложения в продакшене база данных была пустой (только с базовыми настройками из `init.sql`), поэтому Hibernate не смог найти необходимые таблицы (`site`, `page`, `lemma`, `index`) и приложение упало.

## Решение

Изменено значение параметра `ddl-auto` с `validate` на `update` в файле `src/main/resources/application-prod.yaml`:

```yaml
hibernate:
  ddl-auto: update  # было: validate
```

Теперь при запуске Hibernate будет:
- Автоматически создавать отсутствующие таблицы
- Обновлять существующие таблицы при изменении схемы
- Сохранять данные в существующих таблицах

## Что делать дальше

1. Пересоберите Docker-образ приложения:
   ```bash
   docker-compose build app
   ```

2. Перезапустите контейнеры:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

3. Проверьте логи приложения:
   ```bash
   docker logs -f searchengine_app
   ```

Приложение должно успешно запуститься, и Hibernate автоматически создаст все необходимые таблицы в базе данных.

## Важно

Параметр `ddl-auto: update` безопасен для продакшена, так как:
- Не удаляет существующие данные
- Только добавляет новые таблицы/колонки при необходимости
- Не изменяет существующие данные

**Рекомендации:**
- Перед обновлением приложения всегда делайте резервную копию базы данных
- Для больших продакшен-систем рекомендуется использовать инструменты миграции базы данных (например, Flyway или Liquibase) для более контролируемого управления схемой
- При изменении типов данных в сущностях могут возникнуть конфликты - в таких случаях лучше использовать ручные миграции
